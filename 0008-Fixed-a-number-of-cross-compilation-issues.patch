From 0046db367c2327708b36bd93ffe6fa4eba83f65f Mon Sep 17 00:00:00 2001
From: Mr Builder <build@builder1.(none)>
Date: Mon, 24 Mar 2014 02:07:34 +0100
Subject: [PATCH 8/8] Fixed a number of cross-compilation issues.

---
 recipes-pyside/pyside/files/FindQt4.cmake                |  2 +-
 recipes-pyside/pyside/files/cmake-add-modules-path.patch |  1 +
 recipes-pyside/pyside/libshiboken_git.bb                 | 16 ++++++++--------
 recipes-pyside/pyside/python-pyside_git.bb               | 11 ++++++-----
 4 files changed, 16 insertions(+), 14 deletions(-)

diff --git a/recipes-pyside/pyside/files/FindQt4.cmake b/recipes-pyside/pyside/files/FindQt4.cmake
index f7b6e21..ca77521 100644
--- a/recipes-pyside/pyside/files/FindQt4.cmake
+++ b/recipes-pyside/pyside/files/FindQt4.cmake
@@ -757,7 +757,7 @@ MESSAGE(STATUS "${QT_HEADERS_DIR}")
     SET(QT_PHONON_INCLUDE_DIR NOTFOUND)
   ENDIF(QT_QMAKE_CHANGED)
 
-# HACK OE 
+# HACK OE
   FOREACH(QT_MODULE ${QT_MODULES})
     STRING(TOUPPER ${QT_MODULE} _upper_qt_module)
     FIND_PATH(QT_${_upper_qt_module}_INCLUDE_DIR ${QT_MODULE}
diff --git a/recipes-pyside/pyside/files/cmake-add-modules-path.patch b/recipes-pyside/pyside/files/cmake-add-modules-path.patch
index 5da40fd..79f48a8 100644
--- a/recipes-pyside/pyside/files/cmake-add-modules-path.patch
+++ b/recipes-pyside/pyside/files/cmake-add-modules-path.patch
@@ -7,6 +7,7 @@ diff -Naur pyside-qt4.7+1.0.2-orig/CMakeLists.txt pyside-qt4.7+1.0.2/CMakeLists.
                        ${CMAKE_MODULE_PATH})
 +set(CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake/Modules/
 +                      ${CMAKE_MODULE_PATH})
++find_package(Qt4 4.7.0 COMPONENTS QtCore QtGui QtXml REQUIRED) 
  find_package(GeneratorRunner 0.6.9 REQUIRED)
  find_package(Shiboken 1.0.2 REQUIRED)
  find_package(Qt4 4.5.0 REQUIRED)
diff --git a/recipes-pyside/pyside/libshiboken_git.bb b/recipes-pyside/pyside/libshiboken_git.bb
index 8476bc2..d109841 100644
--- a/recipes-pyside/pyside/libshiboken_git.bb
+++ b/recipes-pyside/pyside/libshiboken_git.bb
@@ -3,12 +3,12 @@ bindings for C++ libraries using CPython source code."
 
 HOMEPAGE = "http://www.pyside.org"
 
-DEPENDS = "apiextractor-native generatorrunner-native python-native"
+DEPENDS = "libxslt-native apiextractor-native generatorrunner-native python-native"
 PR = "r0"
 LICENSE = "GPLv2"
 LIC_FILES_CHKSUM = "file://COPYING;md5=34337af480a8c452bfafe22a78fa20cb"
 
-SRC_URI = "git://gitorious.org/pyside/shiboken.git;protocol=git;tag=eb293c2839cfbc726f0e085e1435c94b6f6561f9 \
+SRC_URI = "git://gitorious.org/pyside/shiboken.git;protocol=git;tag=a527dd51e69b80c2d5be3a1d8cd60ab2b2616fa5 \
 			  file://MacroPushRequiredVars.cmake \
 			  file://FindQt4.cmake \
 			  file://rename-shiboken-pkg.patch \
@@ -21,21 +21,21 @@ SRC_URI[md5sum] = "946e8988e5f4c4bd62e774407fa80fee"
 SRC_URI[sha256sum] = "82c6c24dc55458ed047eba9fe700894a3347cd53462b21a97b7b5f9180b2a896"
 #OECMAKE_AR = "`echo ${AR} | sed 's/^\([^ ]*\).*/\1/'`"
 QT_LIBINFIX = "E"
-QT_DIR_NAME = "qtopia"
+QT_DIR_NAME ?= "qt4"
 
 OE_CMAKE_AR = "${STAGING_BINDIR_TOOLCHAIN}/${AR}"
-EXTRA_OECMAKE += " -DPYTHON_EXECUTABLE=${STAGING_BINDIR_NATIVE}/python-native/python2.7 \
+EXTRA_OECMAKE += " -DBUILD_TESTS=FALSE -DPYTHON_EXECUTABLE=${STAGING_BINDIR_NATIVE}/python-native/python2.7 \
 						 -DCMAKE_AR=${OE_CMAKE_AR} \
    					 -DQT_LIBINFIX=${QT_LIBINFIX} \
    					 -DQT_DIR_NAME=${QT_DIR_NAME} \
-						 -DQT_INCLUDE_DIR=${STAGING_INCDIR}/qtopia \
-						 -DQT_QTCORE_INCLUDE_DIR=${STAGING_INCDIR}/qtopia/QtCore \
+						 -DQT_INCLUDE_DIR=${STAGING_INCDIR}/${QT_DIR_NAME} \
+						 -DQT_QTCORE_INCLUDE_DIR=${STAGING_INCDIR}/${QT_DIR_NAME}/QtCore \
 						 -DQT_LIBRARY_DIR=${STAGING_LIBDIR} \
    					 -DSITE_PACKAGE=${STAGING_LIBDIR}/python2.7/site-packages \
    					 -DPYTHON_INCLUDE_DIR:PATH=${STAGING_INCDIR}/python2.7 \
    					 -DPYTHON_LIBRARIES:PATH=${STAGING_LIBDIR}/python2.7 \
                    -DQT_LIBRARY_DIR=${STAGING_INCDIR} \
-                   -DQT_HEADERS_DIR=${STAGING_INCDIR}/qtopia \
+                   -DQT_HEADERS_DIR=${STAGING_INCDIR}/${QT_DIR_NAME} \
                    -DLIBXSLT_INCLUDE_DIR=${STAGING_INCDIR}/libxslt \
                    -DLIBXSLT_LIBRARIES=${STAGING_LIBDIR}/libxslt.so \
 						 -DCMAKE_STAGING_DIR_NATIVE:PATH=${STAGING_DIR_NATIVE} \
@@ -46,7 +46,7 @@ EXTRA_OECMAKE += " -DPYTHON_EXECUTABLE=${STAGING_BINDIR_NATIVE}/python-native/py
 
 #                   -DQT_QTTEST_LIBRARY=${STAGING_LIBDIR}/libQtTestE.so \
 #                   -DQT_QTTEST_LIBRARY_RELEASE=${STAGING_LIBDIR}/libQtTestE.so \
-#                   -DQT_QTCORE_INCLUDE_DIR=${STAGING_INCDIR}/qtopia/QtCore \
+#                   -DQT_QTCORE_INCLUDE_DIR=${STAGING_INCDIR}/${QT_DIR_NAME}/QtCore \
 #						 -DQT_QTCORE_LIBRARY:STRING=${STAGING_LIBDIR}/libQtCoreE.so \
 #						 -DQT_QTGUI_LIBRARY:STRING=${STAGING_LIBDIR}/libQtGuiE.so \
 #						 -DQT_QTNETWORK_LIBRARY:STRING=${STAGING_LIBDIR}/libQtNetworkE.so \
diff --git a/recipes-pyside/pyside/python-pyside_git.bb b/recipes-pyside/pyside/python-pyside_git.bb
index fa41d9b..d10c21d 100644
--- a/recipes-pyside/pyside/python-pyside_git.bb
+++ b/recipes-pyside/pyside/python-pyside_git.bb
@@ -8,6 +8,7 @@ DEPENDS = "apiextractor-native generatorrunner-native shiboken-native libshiboke
 RDEPENDS_${pn} = "python-core"
 PROVIDES = "python-pyside"
 INC_PR = "r2"
+QT_DIR_NAME ?= "qt4"
 
 RDEPENDS_${PN} = " \
  python-lang \
@@ -36,16 +37,16 @@ OE_CMAKE_AR = "${STAGING_BINDIR_TOOLCHAIN}/${AR}"
 EXTRA_OECMAKE += " \
 						 -DCMAKE_AR=${OE_CMAKE_AR} \
    					 -DQT_LIBINFIX=${QT_LIBINFIX} \
-						 -DQT_MKSPECS_DIR=${STAGING_DATADIR}/qtopia/mkspecs/qws/linux-arm-gnueabi-g++/ \
-				       -DQT_INCLUDE_DIR:PATH=${STAGING_INCDIR}/qtopia/ \
-						 -DQT_HEADERS_DIR:PATH=${STAGING_INCDIR}/qtopia \
-						 -DQT_QTCORE_INCLUDE_DIR:PATH=${STAGING_INCDIR}/qtopia/QtCore \
+						 -DQT_MKSPECS_DIR=${STAGING_DATADIR}/${QT_DIR_NAME}/mkspecs/qws/linux-arm-gnueabi-g++/ \
+				       -DQT_INCLUDE_DIR:PATH=${STAGING_INCDIR}/${QT_DIR_NAME}/ \
+						 -DQT_HEADERS_DIR:PATH=${STAGING_INCDIR}/${QT_DIR_NAME} \
+						 -DQT_QTCORE_INCLUDE_DIR:PATH=${STAGING_INCDIR}/${QT_DIR_NAME}/QtCore \
 						 -DQT_QTCORE_LIBRARY:FILE=${STAGING_LIBDIR}/libQtCoreE.so \
 						 -DQT_QTCORE_LIBRARY_RELEASE:FILE=${STAGING_LIBDIR}/libQtCoreE.so \
    					 -DSITE_PACKAGE=${STAGING_LIBDIR}/python2.7/site-packages \
    					 -DPYTHON_INCLUDE_DIR:PATH=${STAGING_INCDIR}/python2.7 \
    					 -DPYTHON_LIBRARIES:PATH=${STAGING_LIBDIR}/python2.7 \
-                   -DQT_HEADERS_DIR=${STAGING_INCDIR}/qtopia \
+                   -DQT_HEADERS_DIR=${STAGING_INCDIR}/${QT_DIR_NAME} \
 						 -DSHIBOKEN_INCLUDE_DIR:PATH=${STAGING_INCDIR}/shiboken \
 						 -DCMAKE_LIBRARY_PATH=${STAGING_LIBDIR} \
 "
-- 
1.8.5.2 (Apple Git-48)

